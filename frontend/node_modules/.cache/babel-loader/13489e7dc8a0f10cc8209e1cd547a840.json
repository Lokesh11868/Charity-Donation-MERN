{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Lokesh\\\\CHARITY-DONATION\\\\frontend\\\\src\\\\components\\\\PaymentForm.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport axios from 'axios';\nimport { load } from '@cashfreepayments/cashfree-js';\n\nfunction DonationForm() {\n  _s();\n\n  var _location$state3, _location$state4;\n\n  const location = useLocation();\n  const history = useHistory(); // Redirect if state is missing\n\n  useEffect(() => {\n    if (!location.state) {\n      alert('Campaign details are missing. Redirecting to campaigns page.');\n      history.push('/allcampaigns'); // Replace with the actual campaigns page route\n    }\n  }, [location.state, history]);\n  const [note, setNote] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    amount: ''\n  });\n  const [cashfree, setCashfree] = useState(null); // State to manage cashfree instance\n\n  const [orderId, setOrderId] = useState(''); // Initialize Cashfree SDK\n\n  useEffect(() => {\n    const initializeSDK = async () => {\n      try {\n        const sdk = await load({\n          mode: 'sandbox' // Change to 'production' for live payments\n\n        });\n        setCashfree(sdk);\n      } catch (error) {\n        console.error('Error initializing Cashfree SDK:', error);\n      }\n    };\n\n    initializeSDK();\n  }, []);\n\n  const handleChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setNote(prev => ({ ...prev,\n      [name]: value\n    }));\n  };\n\n  const getSessionId = async () => {\n    try {\n      var _location$state, _location$state2;\n\n      const res = await axios.post('http://localhost:4000/payment', {\n        name: note.name,\n        email: note.email,\n        phone: note.phone,\n        amount: note.amount,\n        title: (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.title,\n        content: (_location$state2 = location.state) === null || _location$state2 === void 0 ? void 0 : _location$state2.content\n      });\n\n      if (res.data && res.data.payment_session_id) {\n        console.log('Payment session data:', res.data);\n        setOrderId(res.data.order_id);\n        return res.data.payment_session_id;\n      } else {\n        throw new Error('Failed to fetch session ID');\n      }\n    } catch (error) {\n      console.error('Error fetching session ID:', error);\n      throw error;\n    }\n  };\n\n  const verifyPayment = async () => {\n    try {\n      const res = await axios.post('http://localhost:4000/verify', {\n        orderId\n      });\n\n      if (res && res.data) {\n        alert('Payment verified successfully!');\n      }\n    } catch (error) {\n      console.error('Error verifying payment:', error);\n    }\n  };\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n\n    if (!cashfree) {\n      alert('Payment system is not ready. Please try again later.');\n      return;\n    }\n\n    try {\n      const sessionId = await getSessionId();\n      const checkoutOptions = {\n        paymentSessionId: sessionId,\n        redirectTarget: '_modal' // Opens payment in a modal\n\n      };\n      cashfree.checkout(checkoutOptions).then(() => {\n        console.log('Payment initialized');\n        verifyPayment();\n      }).catch(error => {\n        console.error('Error during payment checkout:', error);\n      });\n    } catch (error) {\n      console.error('Error during payment initialization:', error);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-form\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"DONATION FORM\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        name: \"name\",\n        onChange: handleChange,\n        value: note.name,\n        placeholder: \"Name\",\n        type: \"text\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        name: \"email\",\n        onChange: handleChange,\n        value: note.email,\n        placeholder: \"Email\",\n        type: \"email\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        name: \"phone\",\n        onChange: handleChange,\n        value: note.phone,\n        placeholder: \"Phone\",\n        type: \"tel\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        name: \"amount\",\n        onChange: handleChange,\n        value: note.amount,\n        placeholder: \"Amount\",\n        type: \"number\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        name: \"title\",\n        value: ((_location$state3 = location.state) === null || _location$state3 === void 0 ? void 0 : _location$state3.title) || '',\n        placeholder: \"Title\",\n        type: \"text\",\n        readOnly: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        name: \"content\",\n        value: ((_location$state4 = location.state) === null || _location$state4 === void 0 ? void 0 : _location$state4.content) || '',\n        placeholder: \"Content\",\n        type: \"text\",\n        readOnly: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        children: \"Pay Now\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 5\n  }, this);\n}\n\n_s(DonationForm, \"J9cf+xagx+U4huHwcG/fDykiAJc=\", false, function () {\n  return [useLocation, useHistory];\n});\n\n_c = DonationForm;\nexport default DonationForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"DonationForm\");","map":{"version":3,"sources":["C:/Users/Lokesh/CHARITY-DONATION/frontend/src/components/PaymentForm.js"],"names":["React","useState","useEffect","useLocation","useHistory","axios","load","DonationForm","location","history","state","alert","push","note","setNote","name","email","phone","amount","cashfree","setCashfree","orderId","setOrderId","initializeSDK","sdk","mode","error","console","handleChange","e","value","target","prev","getSessionId","res","post","title","content","data","payment_session_id","log","order_id","Error","verifyPayment","handleSubmit","preventDefault","sessionId","checkoutOptions","paymentSessionId","redirectTarget","checkout","then","catch"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useLocation, useHistory } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { load } from '@cashfreepayments/cashfree-js';\r\n\r\nfunction DonationForm() {\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n\r\n  // Redirect if state is missing\r\n  useEffect(() => {\r\n    if (!location.state) {\r\n      alert('Campaign details are missing. Redirecting to campaigns page.');\r\n      history.push('/allcampaigns'); // Replace with the actual campaigns page route\r\n    }\r\n  }, [location.state, history]);\r\n\r\n  const [note, setNote] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    amount: '',\r\n  });\r\n\r\n  const [cashfree, setCashfree] = useState(null); // State to manage cashfree instance\r\n  const [orderId, setOrderId] = useState('');\r\n\r\n  // Initialize Cashfree SDK\r\n  useEffect(() => {\r\n    const initializeSDK = async () => {\r\n      try {\r\n        const sdk = await load({\r\n          mode: 'sandbox', // Change to 'production' for live payments\r\n        });\r\n        setCashfree(sdk);\r\n      } catch (error) {\r\n        console.error('Error initializing Cashfree SDK:', error);\r\n      }\r\n    };\r\n    initializeSDK();\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setNote((prev) => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  const getSessionId = async () => {\r\n    try {\r\n      const res = await axios.post('http://localhost:4000/payment', {\r\n        name: note.name,\r\n        email: note.email,\r\n        phone: note.phone,\r\n        amount: note.amount,\r\n        title: location.state?.title,\r\n        content: location.state?.content,\r\n      });\r\n\r\n      if (res.data && res.data.payment_session_id) {\r\n        console.log('Payment session data:', res.data);\r\n        setOrderId(res.data.order_id);\r\n        return res.data.payment_session_id;\r\n      } else {\r\n        throw new Error('Failed to fetch session ID');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching session ID:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const verifyPayment = async () => {\r\n    try {\r\n      const res = await axios.post('http://localhost:4000/verify', {\r\n        orderId,\r\n      });\r\n\r\n      if (res && res.data) {\r\n        alert('Payment verified successfully!');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error verifying payment:', error);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!cashfree) {\r\n      alert('Payment system is not ready. Please try again later.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const sessionId = await getSessionId();\r\n      const checkoutOptions = {\r\n        paymentSessionId: sessionId,\r\n        redirectTarget: '_modal', // Opens payment in a modal\r\n      };\r\n\r\n      cashfree\r\n        .checkout(checkoutOptions)\r\n        .then(() => {\r\n          console.log('Payment initialized');\r\n          verifyPayment();\r\n        })\r\n        .catch((error) => {\r\n          console.error('Error during payment checkout:', error);\r\n        });\r\n    } catch (error) {\r\n      console.error('Error during payment initialization:', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"payment-form\">\r\n      <h1>DONATION FORM</h1>\r\n      <form onSubmit={handleSubmit}>\r\n        <input\r\n          name=\"name\"\r\n          onChange={handleChange}\r\n          value={note.name}\r\n          placeholder=\"Name\"\r\n          type=\"text\"\r\n          required\r\n        />\r\n\r\n        <input\r\n          name=\"email\"\r\n          onChange={handleChange}\r\n          value={note.email}\r\n          placeholder=\"Email\"\r\n          type=\"email\"\r\n          required\r\n        />\r\n\r\n        <input\r\n          name=\"phone\"\r\n          onChange={handleChange}\r\n          value={note.phone}\r\n          placeholder=\"Phone\"\r\n          type=\"tel\"\r\n          required\r\n        />\r\n\r\n        <input\r\n          name=\"amount\"\r\n          onChange={handleChange}\r\n          value={note.amount}\r\n          placeholder=\"Amount\"\r\n          type=\"number\"\r\n          required\r\n        />\r\n\r\n        <input\r\n          name=\"title\"\r\n          value={location.state?.title || ''}\r\n          placeholder=\"Title\"\r\n          type=\"text\"\r\n          readOnly\r\n        />\r\n\r\n        <input\r\n          name=\"content\"\r\n          value={location.state?.content || ''}\r\n          placeholder=\"Content\"\r\n          type=\"text\"\r\n          readOnly\r\n        />\r\n\r\n        <button type=\"submit\">Pay Now</button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default DonationForm;\r\n"]},"metadata":{},"sourceType":"module"}